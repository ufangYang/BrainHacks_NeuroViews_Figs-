---
title: "GettingStart_maps"
output: html_document
---
```{r setup, include=FALSE}
rm(list=ls())
path= dirname(rstudioapi::getActiveDocumentContext()$path)
setwd(path)
getwd()

library(readr)
library(readxl)
library("writexl")
library(tidyverse)


library(ggplot2)  # FYI you need v2.0
library(dplyr)    # yes, i could have not done this and just used 'subset' instead of 'filter'
library(ggalt)    # devtools::install_github("hrbrmstr/ggalt")
library(ggthemes) # theme_map and tableau colors
library(viridis)

library(ggmap)
library(maps)
library(mapdata)

library(cowplot)   # get_legend() & plot_grid() functions
library(patchwork) # blank plot: plot_spacer()



```

```{r}

df <- read.csv("Data/brainhack-timeline_cleaned_YF.csv")
df_continent <- read.csv("Data/Brainhack timeline - Cleaned_plusContinent.csv")
#df_year2 <- read_csv("Brainhack timeline - Cleaned_BHG Events By Year_withEmptySpacePlaceholderForSunburst.csv")
```


# No needed

- *long* is longitude. Things to the west of the prime meridian are negative.  
- *lat* is latitude.
- *order.*This just shows in which order ggplot should “connect the dots”
- *region and subregion* tell what region or subregion a set of points surrounds.
- *group.* This is very important! ggplot2’s functions can take a group argument which controls (amongst other things) whether adjacent points should be connected by lines. If they are in the same group, then they get connected, but if they are in different groups then they don’t.
  -Essentially, having to points in different groups means that ggplot “lifts the pen” when going between them.





```{r black map legden }


p_map<-ggplot() +
  geom_polygon(data = world,aes(long, lat,  group = group), size = 0.1, alpha=0.9)+
    coord_fixed(1.3)

  #overlaying the data on world map use geom_point()
p_map + geom_point(
    data = df_event,
    aes(long, lat,fill= factor(year), size= freq),
    colour = "white",shape=21,alpha = 0.7) +
  scale_size(range = c(3, 12), name="Number of events")+
  theme(
    legend.title = element_text( size = 14),
    legend.text = element_text( size = 10)
  )+     
  guides(color = guide_legend(override.aes = list(size = 3) ) )+
  coord_fixed(1.3)



# # of eveent

df %>% group_by(Country, City) %>% mutate(freq=n()) %>% ungroup()

ggplot() +
  geom_polygon(data = world,aes(long, lat,  group = group), size = 0.1, alpha=0.9)+
  #overlaying the data on world map use geom_point()
  geom_point(
    data = df_event,
    aes(long, lat,fill= factor(year), size= freq),
    colour = "white",shape=21,alpha = 0.7) +
  scale_size(range = c(3, 12), name="Number of events")+
theme(
  legend.title = element_text( size = 14),
  legend.text = element_text( size = 10)
  )+     
  guides(color = guide_legend(override.aes = list(size = 3) ) )

```


```{r black map}

# get the world map coordinates 
ggplot() +
  geom_polygon(data = world,aes(long, lat,  group = group), size = 0.1, alpha=0.9)+
  #overlaying the data on world map use geom_point()
  geom_point(
    data = df_event,
    aes(long, lat,fill= factor(year), size= freq),
    colour = "white",shape=21,alpha = 0.7) +
  scale_size(range = c(3, 12), name="Frequency")+
  #scale_fill_viridis_c()
  theme_map() +
 # geom_text(data=df_event, aes(long, lat, label = as.character(region)), size=5) +
  expand_limits(x = world$long, y = world$lat)
  coord_map()+
      # remove the x and y axis 
  theme_void() +
  theme(legend.position = "none")

  
  

    labs(x = NULL, 
         y = NULL, 
         title = "Switzerland's regional demographics", 
         subtitle = "Average age in Swiss municipalities, 2015", 
         caption = "Geometries: ThemaKart, BFS; Data: BFS, 2016")

 scale_fill_viridis(option = "magma", discrete = FALSE)



```



# gray map 
```{r gray map}

# get the world map coordinates 
ggplot() +
  geom_map(
    data = world, map = world,
    aes(long, lat, map_id = region),
    color = "white", fill = "gray", size = 0.1
  )+
  #overlaying the data on world map use geom_point()
  geom_point(
    data = df_event,
    aes(lon, lat, color = Country, size=freq),alpha = 0.5) +
  # chnage the size: https://www.r-graph-gallery.com/320-the-basis-of-bubble-plot.html
  scale_size(range = c(3, 12), name="Frequency")+
  scale_color_viridis(discrete=TRUE) +
  # remove the x and y axis 
  theme_void() +
  theme(legend.position = "none")

```


# plot map across years 


```{r}
# https://rud.is/b/2015/12/28/world-map-panel-plots-with-ggplot2-2-0-ggalt/

library(ggplot2)  # FYI you need v2.0
library(dplyr)    # yes, i could have not done this and just used 'subset' instead of 'filter'
library(ggalt)    # devtools::install_github("hrbrmstr/ggalt")
library(ggthemes) # theme_map and tableau colors


ggplot() +
  geom_map(
    data = world, map = world,
    aes(long, lat, map_id = region), color="white", fill="#7f7f7f", size=0.1, alpha=0.3)+
  #overlaying the data on world map use geom_point()
  geom_point(
    data = df_event,
    aes(lon, lat, color = Country),
    size=6, alpha=0.7) +
  facet_wrap(~sorted.by.year, labeller = label_both)+
  #scale_fill_viridis(discrete=FALSE, guide=FALSE, option="A")
  # remove the x and y axis 
  theme_void() +
  theme(legend.position = "none")
```

